<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=author content="niceRAM"><meta name=description content="niceRAM's Blog"><link rel=prev href=https://niceram.xyz/2021/04/15/20210415_2157/><link rel=next href=https://niceram.xyz/2021/11/13/20211113_1255/><link rel=canonical href=https://niceram.xyz/2021/07/07/20210707_1441/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>Angular è·å–åŸç”Ÿ DOM å¯¹è±¡æ—¶å‡ºç° 'undefined' | NiceBlog</title><meta name=title content="Angular è·å–åŸç”Ÿ DOM å¯¹è±¡æ—¶å‡ºç° 'undefined' | NiceBlog"><link rel=stylesheet href=/css/main.min.css><link rel=stylesheet href=/font/iconfont.css><link rel=stylesheet href=/font-ali/iconfont.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/niceram.xyz\/"},"articleSection":"posts","name":"Angular è·å–åŸç”Ÿ DOM å¯¹è±¡æ—¶å‡ºç° \u0027undefined\u0027","headline":"Angular è·å–åŸç”Ÿ DOM å¯¹è±¡æ—¶å‡ºç° \u0027undefined\u0027","description":"æœ€è¿‘æ­£å†™ä¸ªå°é¡¹ç›®å¤ä¹  Angularï¼Œåœ¨ DOM å¯¹è±¡çš„è·å–ä¸Šé‡åˆ°äº†ä¸ªç¦»å¥‡çš„é—®é¢˜ï¼Œç›®å‰è™½ç„¶å·²ç»è§£å†³ï¼Œä½†åŸç†è¿˜æ²¡å®Œå…¨ææ‡‚ï¼Œå…ˆè®°å½•ä¸‹æ¥ã€‚ é—®é¢˜ Angular ç»„ä»¶é—´é€šä¿¡ä¼š","inLanguage":"zh-CN","author":"niceRAM","creator":"niceRAM","publisher":"niceRAM","accountablePerson":"niceRAM","copyrightHolder":"niceRAM","copyrightYear":"2021","datePublished":"2021-07-07 14:41:56 \u002b0800 \u002b0800","dateModified":"2021-07-07 14:41:56 \u002b0800 \u002b0800","url":"https:\/\/niceram.xyz\/2021\/07\/07\/20210707_1441\/","wordCount":"1341","keywords":["Angular","ElementRef","NiceBlog"]}</script></head><body><div class=wrapper><nav class=navbar><progress class=content_progress max=0 value=0></progress><div class=container><div class="navbar-header header-back2home-logo"><span class=logo_mark>>$</span>
<a href=https://niceram.xyz/><span class=logo_text>cd /home/</span>
<span class=logo_cursor></span></a></div><div class=navbar-right><span class=menu><a class=menu-item href=/posts/ title>ğŸ“šBlog</a>
<a class=menu-item href=/categories/ title>ğŸ“‚Categories</a>
<a class=menu-item href=/tags/ title>ğŸ“ŒTags</a>
<a class=menu-item href=/about/ title>ğŸ’¬About</a>
<span class=divide></span><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></span></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><progress class=content_progress max=0 value=0></progress><div class=container><div class=navbar><div class="navbar-header header-logo"><a href=https://niceram.xyz/>NiceBlog</a></div><div class=navbar-right><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></div><div class=menu-toggle><span></span><span></span><span></span></div></div></div><div class=menu id=mobile-menu><nav class=mb-md><a class=menu-item href=/posts/ title><h3>ğŸ“šBlog</h3><div class=menu-active></div></a><a class=menu-item href=/categories/ title><h3>ğŸ“‚Categories</h3><div class=menu-active></div></a><a class=menu-item href=/tags/ title><h3>ğŸ“ŒTags</h3><div class=menu-active></div></a><a class=menu-item href=/about/ title><h3>ğŸ’¬About</h3><div class=menu-active></div></a></nav></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">Angular è·å–åŸç”Ÿ DOM å¯¹è±¡æ—¶å‡ºç° 'undefined'</h1><div class=post-meta>Written by <a itemprop=name href=https://niceram.xyz/ rel=author>niceRAM</a> with â™¥
<span class=post-time>on <time datetime=2021-07-07 itemprop=datePublished>July 7, 2021</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=https://niceram.xyz/categories/%E8%BF%99%E9%83%BD%E4%BB%80%E4%B9%88%E9%AC%BC%E9%97%AE%E9%A2%98/>è¿™éƒ½ä»€ä¹ˆé¬¼é—®é¢˜,</a></span>
<span class=post-word-count>1341 words</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title></h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#é—®é¢˜>é—®é¢˜</a></li><li><a href=#åˆ†æ>åˆ†æ</a></li><li><a href=#è§£å†³>è§£å†³</a></li></ul></nav></div></div><div class=post-content><p>æœ€è¿‘æ­£å†™ä¸ªå°é¡¹ç›®å¤ä¹  Angularï¼Œåœ¨ DOM å¯¹è±¡çš„è·å–ä¸Šé‡åˆ°äº†ä¸ªç¦»å¥‡çš„é—®é¢˜ï¼Œç›®å‰è™½ç„¶å·²ç»è§£å†³ï¼Œä½†åŸç†è¿˜æ²¡å®Œå…¨ææ‡‚ï¼Œå…ˆè®°å½•ä¸‹æ¥ã€‚</p><hr><h2 id=é—®é¢˜>é—®é¢˜</h2><p>Angular ç»„ä»¶é—´é€šä¿¡ä¼šç”¨åˆ° <code>@Input()</code>ã€<code>@ViewChild()</code> ç­‰è£…é¥°å™¨ï¼Œæ­£å¸¸çš„ Angular ç»„ä»¶é€šä¿¡ä¸å‡ºæ„å¤–éƒ½æ˜¯æ²¡é—®é¢˜çš„ï¼Œä¸å†å¤šè®²ã€‚</p><span class=spoiler>ç”±äºä¸´æ—¶æƒ³åˆ°è®°å½•ä¸‹æ¥æ€•ä»¥åå¿˜è®°ï¼Œè€Œé—®é¢˜å·²ç»è§£å†³ï¼Œå½“æ—¶æ²¡æœ‰æˆªå›¾ï¼Œæ‰€ä»¥åªæ˜¯â€œç®€å•åœ°â€ç”¨æ–‡å­—è®°å½•ä¸‹</span><p>å¦‚æœè¦è·å–åŸç”Ÿçš„ DOM å¯¹è±¡ï¼Œéšä¾¿æŸ¥æŸ¥å°±èƒ½çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„å†™æ³•(ä¼ªä»£ç )</p><div class=highlight><pre class=chroma><code class=language-ts data-lang=ts><span class=ln> 1</span><span class=kr>import</span> <span class=p>{</span> <span class=nx>AfterViewInit</span><span class=p>,</span> <span class=nx>ElementRef</span><span class=p>,</span> <span class=nx>ViewChild</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@angular/core&#39;</span><span class=p>;</span>
<span class=ln> 2</span>
<span class=ln> 3</span><span class=kd>@Component</span><span class=p>({</span>
<span class=ln> 4</span>  <span class=nx>selector</span><span class=o>:</span> <span class=s1>&#39;app-file-preview&#39;</span><span class=p>,</span>
<span class=ln> 5</span>  <span class=nx>templateUrl</span><span class=o>:</span> <span class=s1>&#39;./file-preview.component.html&#39;</span><span class=p>,</span>
<span class=ln> 6</span>  <span class=nx>styleUrls</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;./file-preview.component.scss&#39;</span><span class=p>]</span>
<span class=ln> 7</span><span class=p>})</span>
<span class=ln> 8</span><span class=kr>export</span> <span class=kr>class</span> <span class=nx>FilePreviewComponent</span> <span class=kr>implements</span> <span class=nx>AfterViewInit</span> <span class=p>{</span>
<span class=hl><span class=ln> 9</span>  <span class=kd>@ViewChild</span><span class=p>(</span><span class=s2>&#34;imageViewer&#34;</span><span class=p>)</span> <span class=nx>imageViewer</span><span class=o>!:</span> <span class=nx>ElementRef</span><span class=p>;</span>
</span><span class=ln>10</span>
<span class=ln>11</span>  <span class=nx>ngAfterViewInit</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
<span class=ln>12</span>    <span class=k>this</span><span class=p>.</span><span class=nx>imageViewer</span><span class=p>.</span><span class=nx>nativeElement</span><span class=p>.</span><span class=nx>src</span> <span class=o>=</span> <span class=s2>&#34;https://example.com/xxx.jpg&#34;</span><span class=p>;</span>
<span class=ln>13</span>  <span class=p>}</span>
</code></pre></div><p>ç®€å•çš„ä½¿ç”¨è²Œä¼¼æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚æœé‡åˆ°è·å–çš„å¯¹è±¡æ˜¯ <code>undefined</code> åœ¨è§†å›¾åˆå§‹åŒ–ä¹‹åå†å¤„ç†å¯¹è±¡å°±è¡Œï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ <code>ngAfterViewInit</code> ä»£æ›¿ <code>onInit</code>ã€‚</p><p>è€Œæˆ‘çš„éœ€æ±‚ç¨å¾®éº»çƒ¦ç‚¹ï¼š</p><ol><li>æ ¹æ®æ–‡ä»¶å¯¹è±¡åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œå¾—åˆ°ä¸åŒçš„ç»„ä»¶åˆå§‹åŒ–æ–¹æ³•</li><li>æ ¹æ®æ–‡ä»¶å¯¹è±¡è·å–è¿œç«¯çš„æ–‡ä»¶åœ°å€ï¼Œå¾—åˆ°å¯è§‚å¯Ÿå¯¹è±¡</li><li>å¾—åˆ°å¯è§‚å¯Ÿå¯¹è±¡åï¼Œæ ¹æ® 1 å¾—åˆ°çš„åˆå§‹åŒ–æ–¹æ³•å¯¹ç»„ä»¶åˆå§‹åŒ–</li></ol><p>å‰ä¸¤æ­¥æ­£å¸¸è¿è¡Œï¼Œç¬¬ä¸‰æ­¥å‡ºç° <code>undefined</code>ï¼ŒæŠ¥é”™çš„éƒ¨åˆ†ç›¸å…³ä»£ç å¦‚ä¸‹</p><div class=highlight><pre class=chroma><code class=language-ts data-lang=ts><span class=ln> 1</span><span class=kr>import</span> <span class=p>{...}</span> <span class=kr>from</span> <span class=p>...;</span>
<span class=ln> 2</span>
<span class=ln> 3</span><span class=kd>@Component</span><span class=p>({</span>
<span class=ln> 4</span>  <span class=p>...</span>
<span class=ln> 5</span><span class=p>})</span>
<span class=ln> 6</span><span class=kr>export</span> <span class=kr>class</span> <span class=nx>FilePreviewComponent</span> <span class=kr>implements</span> <span class=nx>OnInit</span><span class=p>,</span> <span class=nx>AfterViewInit</span> <span class=p>{</span>
<span class=ln> 7</span>  <span class=kd>@Input</span><span class=p>()</span> <span class=nx>file</span><span class=o>!:</span> <span class=nx>File</span><span class=p>;</span>
<span class=ln> 8</span>  <span class=kd>@ViewChild</span><span class=p>(</span><span class=s2>&#34;mediaViewer&#34;</span><span class=p>)</span> <span class=nx>mediaViewer</span><span class=o>!:</span> <span class=nx>ElementRef</span><span class=p>;</span>
<span class=ln> 9</span>
<span class=ln>10</span>  <span class=nx>fileUrl</span><span class=o>!:</span> <span class=kt>string</span><span class=p>;</span>
<span class=ln>11</span>
<span class=ln>12</span>  <span class=nx>groupId</span> <span class=o>=</span> <span class=nx>environment</span><span class=p>.</span><span class=nx>groupId</span><span class=p>;</span>
<span class=ln>13</span>  <span class=nx>isVideo</span><span class=o>!:</span> <span class=kr>boolean</span><span class=p>;</span>
<span class=ln>14</span>  <span class=nx>isAudio</span><span class=o>!:</span> <span class=kr>boolean</span><span class=p>;</span>
<span class=ln>15</span>  <span class=nx>isImage</span><span class=o>!:</span> <span class=kr>boolean</span><span class=p>;</span>
<span class=ln>16</span>
<span class=ln>17</span>  <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>fileService</span>: <span class=kt>FileService</span><span class=p>)</span> <span class=p>{</span> <span class=p>}</span>
<span class=ln>18</span>
<span class=ln>19</span>  <span class=nx>ngAfterViewInit</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
<span class=hl><span class=ln>20</span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>mediaViewer</span><span class=p>.</span><span class=nx>nativeElement</span><span class=p>);</span>  <span class=c1>// =&gt; [object Object]
</span></span><span class=ln>21</span><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>isVideo</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;mp4&#34;</span><span class=p>,</span> <span class=s2>&#34;mkv&#34;</span><span class=p>,</span> <span class=s2>&#34;flv&#34;</span><span class=p>,</span> <span class=s2>&#34;wmv&#34;</span><span class=p>,</span> <span class=s2>&#34;avi&#34;</span><span class=p>]</span>
<span class=ln>22</span>      <span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>getFileType</span><span class=p>())</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
<span class=ln>23</span>    <span class=k>this</span><span class=p>.</span><span class=nx>isAudio</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;mp3&#34;</span><span class=p>,</span> <span class=s2>&#34;wav&#34;</span><span class=p>,</span> <span class=s2>&#34;flac&#34;</span><span class=p>,</span> <span class=s2>&#34;m4a&#34;</span><span class=p>,</span> <span class=s2>&#34;aac&#34;</span><span class=p>,</span> <span class=s2>&#34;pcm&#34;</span><span class=p>]</span>
<span class=ln>24</span>      <span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>getFileType</span><span class=p>())</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
<span class=ln>25</span>    <span class=k>this</span><span class=p>.</span><span class=nx>isImage</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;png&#34;</span><span class=p>,</span> <span class=s2>&#34;jpg&#34;</span><span class=p>,</span> <span class=s2>&#34;jpeg&#34;</span><span class=p>,</span> <span class=s2>&#34;gif&#34;</span><span class=p>]</span>
<span class=ln>26</span>      <span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>getFileType</span><span class=p>())</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
<span class=ln>27</span>
<span class=hl><span class=ln>28</span>    <span class=kr>const</span> <span class=nx>mediaInitializer</span>: <span class=kt>any</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span><span class=hl><span class=ln>29</span>
</span><span class=hl><span class=ln>30</span>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>isVideo</span><span class=p>)</span> <span class=p>{</span>
</span><span class=hl><span class=ln>31</span>      <span class=nx>mediaInitializer</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>initVideoPlayer</span><span class=p>;</span>
</span><span class=hl><span class=ln>32</span>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>isAudio</span><span class=p>)</span> <span class=p>{</span>
</span><span class=hl><span class=ln>33</span>      <span class=nx>mediaInitializer</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>initAudioPlayer</span><span class=p>;</span>
</span><span class=hl><span class=ln>34</span>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>isImage</span><span class=p>)</span> <span class=p>{</span>
</span><span class=hl><span class=ln>35</span>      <span class=nx>mediaInitializer</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>initImageViewer</span><span class=p>;</span>
</span><span class=hl><span class=ln>36</span>    <span class=p>}</span>
</span><span class=ln>37</span>
<span class=ln>38</span>    <span class=k>if</span> <span class=p>(</span><span class=nx>mediaInitializer</span><span class=p>)</span> <span class=p>{</span>
<span class=ln>39</span>      <span class=k>this</span><span class=p>.</span><span class=nx>fileService</span><span class=p>.</span><span class=nx>getGroupFileUrl</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>groupId</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>fileId</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>busid</span><span class=p>)</span>
<span class=ln>40</span>        <span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>resp</span> <span class=o>=&gt;</span> <span class=p>{</span>
<span class=ln>41</span>          <span class=k>this</span><span class=p>.</span><span class=nx>fileUrl</span> <span class=o>=</span> <span class=nx>resp</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>url</span><span class=p>;</span>
<span class=hl><span class=ln>42</span>          <span class=nx>mediaInitializer</span><span class=p>();</span>
</span><span class=ln>43</span>        <span class=p>})</span>
<span class=ln>44</span>    <span class=p>}</span>
<span class=ln>45</span>  <span class=p>}</span>
<span class=ln>46</span>
<span class=ln>47</span>  <span class=nx>ngOnInit</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span> <span class=p>}</span>
<span class=ln>48</span>
<span class=ln>49</span>  <span class=cm>/**
</span><span class=ln>50</span><span class=cm>   * è§†é¢‘æ’­æ”¾å™¨åˆå§‹åŒ–
</span><span class=ln>51</span><span class=cm>   * 
</span><span class=ln>52</span><span class=cm>   * @param fileUrl 
</span><span class=ln>53</span><span class=cm>   */</span>
<span class=ln>54</span>  <span class=nx>initVideoPlayer</span><span class=p>(</span><span class=nx>fileUrl?</span>: <span class=kt>string</span><span class=p>)</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
<span class=hl><span class=ln>55</span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>mediaViewer</span><span class=p>.</span><span class=nx>nativeElement</span><span class=p>);</span>  <span class=c1>// =&gt; cannot read property &#39;mediaViewer&#39; of undefined.
</span></span><span class=ln>56</span><span class=c1></span>  <span class=p>}</span>
<span class=ln>57</span>
<span class=ln>58</span>  <span class=cm>/**
</span><span class=ln>59</span><span class=cm>   * éŸ³é¢‘æ’­æ”¾å™¨åˆå§‹åŒ–
</span><span class=ln>60</span><span class=cm>   * 
</span><span class=ln>61</span><span class=cm>   * @param fileUrl 
</span><span class=ln>62</span><span class=cm>   */</span>
<span class=ln>63</span>  <span class=nx>initAudioPlayer</span><span class=p>(</span><span class=nx>fileUrl?</span>: <span class=kt>string</span><span class=p>)</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
<span class=ln>64</span>    <span class=p>...</span>
<span class=ln>65</span>  <span class=p>}</span>
<span class=ln>66</span>
<span class=ln>67</span>  <span class=cm>/**
</span><span class=ln>68</span><span class=cm>   * å›¾ç‰‡é¢„è§ˆåˆå§‹åŒ–
</span><span class=ln>69</span><span class=cm>   * 
</span><span class=ln>70</span><span class=cm>   * @param fileUrl 
</span><span class=ln>71</span><span class=cm>   */</span>
<span class=ln>72</span>  <span class=nx>initImageViewer</span><span class=p>(</span><span class=nx>fileUrl?</span>: <span class=kt>string</span><span class=p>)</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
<span class=ln>73</span>    <span class=p>...</span>
<span class=ln>74</span>  <span class=p>}</span>
<span class=ln>75</span><span class=p>}</span>
</code></pre></div><h2 id=åˆ†æ>åˆ†æ</h2><p>æ ¹æ®ä¸Šé¢åœ¨ <code>ngAfterViewInit</code> å’Œ <code>initVideoPlayer</code> åˆ†åˆ«æ‰“å°çš„ç»“æœæ¥åˆ†æï¼Œ
è§†å›¾åˆå§‹åŒ–å <code>this.mediaViewer</code> å·²ç»èƒ½è·å–åˆ°äº†ï¼Œé‚£ä¹ˆåœ¨è§†å›¾åˆå§‹åŒ–ä¹‹åæ‰è°ƒç”¨çš„æ–¹æ³•ä¸­ï¼Œ
ç†è®ºä¸Š <code>this.mediaViewer</code> åº”è¯¥ä¹Ÿæ˜¯å­˜åœ¨çš„ï¼Œç„¶è€Œå´è·å–æŠ¥é”™ã€‚</p><p>å¦‚æœç½‘ä¸ŠæŸ¥ä¸€æŸ¥ï¼Œå¤§å¤šæ•°è¯´çš„éƒ½æ˜¯åŒæ ·çš„è§£å†³åŠæ³•ï¼Œä»–ä»¬çš„é—®é¢˜éƒ½æ˜¯ä¸€æ ·çš„ï¼šDOM å¯¹è±¡åˆå§‹åŒ–ä¹‹å‰å°±ä½¿ç”¨äº†å˜é‡ã€‚
æ‰€ä»¥åªéœ€è¦æ¢ä¸ªäº‹ä»¶ç›‘å¬å°±å¥½ã€‚</p><p>ä½†æˆ‘è¿™ä¸ªé—®é¢˜è²Œä¼¼æœ‰ç‚¹ä¸åŒï¼Œä»”ç»†çœ‹ä¸€ä¸‹æŠ¥é”™ï¼š <code>cannot read property 'mediaViewer' of undefined.</code> <span class=spoiler>å‡­è®°å¿†æ•²çš„ï¼Œå¯èƒ½å’ŒåŸæ¥çš„ message æœ‰ç‚¹å‡ºå…¥</span></p><p>æŠ¥é”™å¹¶ä¸æ˜¯ <code>this.mediaViewer</code> æ˜¯ <code>undefined</code>ï¼Œè€Œæ˜¯è¯´æ— æ³•ä» <code>undefined</code> è·å–åä¸º <code>mediaViewer</code> çš„å±æ€§â€¦â€¦
æ˜æ˜æ˜¯ä» <code>this</code> è·å–çš„è‡ªå®šä¹‰å±æ€§ï¼Œè¿™ä¹ˆè¯´çš„è¯ï¼Œ<code>initVideoPlayer</code> ä¸­ <code>this</code> å‘ç”Ÿäº†ä»€ä¹ˆå¥‡æ€ªçš„å˜åŒ–ï¼Ÿ
è¯•ç€æ‰“å°ä¸€ä¸‹ï¼ˆä»£ç ç•¥ï¼‰ï¼Œæœç„¶å‰è€…è¿˜æ˜¯å¯¹è±¡ï¼Œåè€…å°±æˆäº† <code>undefined</code>ã€‚</p><p>æ›´å¤šçš„ï¼Œç”±äºæœ¬äºº javascript ç»éªŒä¸å¤šï¼Œæ— æ³•åšå‡ºæ›´ç¡®åˆ‡çš„åˆ†æã€‚
çŒœæµ‹æˆ–è®¸æ˜¯å› ä¸ºè¿™æ®µä»£ç çš„èµ‹å€¼ï¼Œå¯¼è‡´è·å–åˆ°çš„æ–¹æ³•ç”± <code>method</code> è½¬æ¢æˆäº† <code>function</code> å¯¼è‡´ï¼Ÿ</p><div class=highlight><pre class=chroma><code class=language-ts data-lang=ts><span class=ln>1</span>    <span class=kr>const</span> <span class=nx>mediaInitializer</span>: <span class=kt>any</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
<span class=ln>2</span>
<span class=ln>3</span>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>isVideo</span><span class=p>)</span> <span class=p>{</span>
<span class=ln>4</span>      <span class=nx>mediaInitializer</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>initVideoPlayer</span><span class=p>;</span>
<span class=ln>5</span>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>isAudio</span><span class=p>)</span> <span class=p>{</span>
<span class=ln>6</span>      <span class=nx>mediaInitializer</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>initAudioPlayer</span><span class=p>;</span>
<span class=ln>7</span>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>isImage</span><span class=p>)</span> <span class=p>{</span>
<span class=ln>8</span>      <span class=nx>mediaInitializer</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>initImageViewer</span><span class=p>;</span>
<span class=ln>9</span>    <span class=p>}</span>
</code></pre></div><h2 id=è§£å†³>è§£å†³</h2><p>é¡ºç€ä¸Šé¢çš„åˆ†æï¼Œå°† <code>mediaInitializer</code> ä½œä¸ºå±æ€§èµ‹å€¼ï¼Œè€Œä¸æ˜¯å±€éƒ¨å˜é‡ï¼Œä»¥æ­¤è§£å†³é—®é¢˜ã€‚</p><div class=highlight><pre class=chroma><code class=language-ts data-lang=ts><span class=ln> 1</span><span class=kr>import</span> <span class=p>{...}</span> <span class=kr>from</span> <span class=p>...;</span>
<span class=ln> 2</span>
<span class=ln> 3</span><span class=kd>@Component</span><span class=p>({</span>
<span class=ln> 4</span>  <span class=p>...</span>
<span class=ln> 5</span><span class=p>})</span>
<span class=ln> 6</span><span class=kr>export</span> <span class=kr>class</span> <span class=nx>FilePreviewComponent</span> <span class=kr>implements</span> <span class=nx>OnInit</span><span class=p>,</span> <span class=nx>AfterViewInit</span> <span class=p>{</span>
<span class=ln> 7</span>  <span class=kd>@Input</span><span class=p>()</span> <span class=nx>file</span><span class=o>!:</span> <span class=nx>File</span><span class=p>;</span>
<span class=ln> 8</span>  <span class=kd>@ViewChild</span><span class=p>(</span><span class=s2>&#34;mediaViewer&#34;</span><span class=p>)</span> <span class=nx>mediaViewer</span><span class=o>!:</span> <span class=nx>ElementRef</span><span class=p>;</span>
<span class=ln> 9</span>
<span class=ln>10</span>  <span class=nx>fileUrl</span><span class=o>!:</span> <span class=kt>string</span><span class=p>;</span>
<span class=ln>11</span>
<span class=ln>12</span>  <span class=nx>groupId</span> <span class=o>=</span> <span class=nx>environment</span><span class=p>.</span><span class=nx>groupId</span><span class=p>;</span>
<span class=ln>13</span>  <span class=nx>isVideo</span><span class=o>!:</span> <span class=kr>boolean</span><span class=p>;</span>
<span class=ln>14</span>  <span class=nx>isAudio</span><span class=o>!:</span> <span class=kr>boolean</span><span class=p>;</span>
<span class=ln>15</span>  <span class=nx>isImage</span><span class=o>!:</span> <span class=kr>boolean</span><span class=p>;</span>
<span class=hl><span class=ln>16</span>  <span class=nx>mediaInitializer</span>: <span class=kt>any</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span><span class=ln>17</span>
<span class=ln>18</span>  <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>fileService</span>: <span class=kt>FileService</span><span class=p>)</span> <span class=p>{</span> <span class=p>}</span>
<span class=ln>19</span>
<span class=ln>20</span>  <span class=nx>ngAfterViewInit</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
<span class=ln>21</span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>mediaViewer</span><span class=p>.</span><span class=nx>nativeElement</span><span class=p>);</span>  <span class=c1>// =&gt; [object Object]
</span><span class=hl><span class=ln>22</span><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>mediaInitializer</span><span class=p>)</span> <span class=p>{</span>
</span><span class=ln>23</span>      <span class=k>this</span><span class=p>.</span><span class=nx>fileService</span><span class=p>.</span><span class=nx>getGroupFileUrl</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>groupId</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>fileId</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>busid</span><span class=p>)</span>
<span class=ln>24</span>        <span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>resp</span> <span class=o>=&gt;</span> <span class=p>{</span>
<span class=ln>25</span>          <span class=k>this</span><span class=p>.</span><span class=nx>fileUrl</span> <span class=o>=</span> <span class=nx>resp</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>url</span><span class=p>;</span>
<span class=hl><span class=ln>26</span>          <span class=k>this</span><span class=p>.</span><span class=nx>mediaInitializer</span><span class=p>();</span>
</span><span class=ln>27</span>        <span class=p>})</span>
<span class=ln>28</span>    <span class=p>}</span>
<span class=ln>29</span>  <span class=p>}</span>
<span class=ln>30</span>
<span class=ln>31</span>  <span class=nx>ngOnInit</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
<span class=ln>32</span>    <span class=k>this</span><span class=p>.</span><span class=nx>isVideo</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;mp4&#34;</span><span class=p>,</span> <span class=s2>&#34;mkv&#34;</span><span class=p>,</span> <span class=s2>&#34;flv&#34;</span><span class=p>,</span> <span class=s2>&#34;wmv&#34;</span><span class=p>,</span> <span class=s2>&#34;avi&#34;</span><span class=p>]</span>
<span class=ln>33</span>      <span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>getFileType</span><span class=p>())</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
<span class=ln>34</span>    <span class=k>this</span><span class=p>.</span><span class=nx>isAudio</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;mp3&#34;</span><span class=p>,</span> <span class=s2>&#34;wav&#34;</span><span class=p>,</span> <span class=s2>&#34;flac&#34;</span><span class=p>,</span> <span class=s2>&#34;m4a&#34;</span><span class=p>,</span> <span class=s2>&#34;aac&#34;</span><span class=p>,</span> <span class=s2>&#34;pcm&#34;</span><span class=p>]</span>
<span class=ln>35</span>      <span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>getFileType</span><span class=p>())</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
<span class=ln>36</span>    <span class=k>this</span><span class=p>.</span><span class=nx>isImage</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;png&#34;</span><span class=p>,</span> <span class=s2>&#34;jpg&#34;</span><span class=p>,</span> <span class=s2>&#34;jpeg&#34;</span><span class=p>,</span> <span class=s2>&#34;gif&#34;</span><span class=p>]</span>
<span class=ln>37</span>      <span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>getFileType</span><span class=p>())</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
<span class=ln>38</span>
<span class=ln>39</span>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>isVideo</span><span class=p>)</span> <span class=p>{</span>
<span class=hl><span class=ln>40</span>      <span class=k>this</span><span class=p>.</span><span class=nx>mediaInitializer</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>initVideoPlayer</span><span class=p>;</span>
</span><span class=ln>41</span>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>isAudio</span><span class=p>)</span> <span class=p>{</span>
<span class=hl><span class=ln>42</span>      <span class=k>this</span><span class=p>.</span><span class=nx>mediaInitializer</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>initAudioPlayer</span><span class=p>;</span>
</span><span class=ln>43</span>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>isImage</span><span class=p>)</span> <span class=p>{</span>
<span class=hl><span class=ln>44</span>      <span class=k>this</span><span class=p>.</span><span class=nx>mediaInitializer</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>initImageViewer</span><span class=p>;</span>
</span><span class=ln>45</span>    <span class=p>}</span>
<span class=ln>46</span>  <span class=p>}</span>
<span class=ln>47</span>
<span class=ln>48</span>  <span class=cm>/**
</span><span class=ln>49</span><span class=cm>   * è§†é¢‘æ’­æ”¾å™¨åˆå§‹åŒ–
</span><span class=ln>50</span><span class=cm>   * 
</span><span class=ln>51</span><span class=cm>   * @param fileUrl 
</span><span class=ln>52</span><span class=cm>   */</span>
<span class=ln>53</span>  <span class=nx>initVideoPlayer</span><span class=p>(</span><span class=nx>fileUrl?</span>: <span class=kt>string</span><span class=p>)</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
<span class=ln>54</span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>mediaViewer</span><span class=p>.</span><span class=nx>nativeElement</span><span class=p>);</span>  <span class=c1>// =&gt; [object Object]
</span><span class=ln>55</span><span class=c1></span>  <span class=p>}</span>
<span class=ln>56</span>
<span class=ln>57</span>  <span class=cm>/**
</span><span class=ln>58</span><span class=cm>   * éŸ³é¢‘æ’­æ”¾å™¨åˆå§‹åŒ–
</span><span class=ln>59</span><span class=cm>   * 
</span><span class=ln>60</span><span class=cm>   * @param fileUrl 
</span><span class=ln>61</span><span class=cm>   */</span>
<span class=ln>62</span>  <span class=nx>initAudioPlayer</span><span class=p>(</span><span class=nx>fileUrl?</span>: <span class=kt>string</span><span class=p>)</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
<span class=ln>63</span>    <span class=p>...</span>
<span class=ln>64</span>  <span class=p>}</span>
<span class=ln>65</span>
<span class=ln>66</span>  <span class=cm>/**
</span><span class=ln>67</span><span class=cm>   * å›¾ç‰‡é¢„è§ˆåˆå§‹åŒ–
</span><span class=ln>68</span><span class=cm>   * 
</span><span class=ln>69</span><span class=cm>   * @param fileUrl 
</span><span class=ln>70</span><span class=cm>   */</span>
<span class=ln>71</span>  <span class=nx>initImageViewer</span><span class=p>(</span><span class=nx>fileUrl?</span>: <span class=kt>string</span><span class=p>)</span><span class=o>:</span> <span class=k>void</span> <span class=p>{</span>
<span class=ln>72</span>    <span class=p>...</span>
<span class=ln>73</span>  <span class=p>}</span>
<span class=ln>74</span><span class=p>}</span>
</code></pre></div></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>niceRAM</span></p><p class=copyright-item><span>Link:</span>
<a href=https://niceram.xyz/2021/07/07/20210707_1441/>https://niceram.xyz/2021/07/07/20210707_1441/</a></p><p class="copyright-item lincese">æœ¬æ–‡é‡‡ç”¨<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/ target=_blank>çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯</p></div><div class=post-tags><section><i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=https://niceram.xyz/tags/angular/>#Angular</a></span>
<span class=tag><a href=https://niceram.xyz/tags/elementref/>#ElementRef</a></span></section><section><a href=javascript:window.history.back();>back</a></span> Â·
<span><a href=https://niceram.xyz/>home</a></span></section></div><div class=post-nav><a href=https://niceram.xyz/2021/04/15/20210415_2157/ class=prev rel=prev title="Docker + Miniconda + VSCode Remote SSH åœ¨ Ubuntu æ­å»ºå¤šç‰ˆæœ¬å…±å­˜çš„ TensorFlow-GPU è¿œç¨‹å¼€å‘ç¯å¢ƒ"><i class="iconfont icon-left"></i>&nbsp;Docker + Miniconda + VSCode Remote SSH åœ¨ Ubuntu æ­å»ºå¤šç‰ˆæœ¬å…±å­˜çš„ TensorFlow-GPU è¿œç¨‹å¼€å‘ç¯å¢ƒ</a>
<a href=https://niceram.xyz/2021/11/13/20211113_1255/ class=next rel=next title="ä½¿ç”¨ Docker æ„å»º Caddy v1 å¹¶è‡ªå®šä¹‰æ’ä»¶">ä½¿ç”¨ Docker æ„å»º Caddy v1 å¹¶è‡ªå®šä¹‰æ’ä»¶&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-social><div class=social-links><style type=text/css>@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_1910062_4213q7gpkpy.eot);src:url(//at.alicdn.com/t/font_1910062_4213q7gpkpy.eot?#iefix)format('embedded-opentype'),url(//at.alicdn.com/t/font_1910062_4213q7gpkpy.woff2)format('woff2'),url(//at.alicdn.com/t/font_1910062_4213q7gpkpy.woff)format('woff'),url(//at.alicdn.com/t/font_1910062_4213q7gpkpy.ttf)format('truetype'),url(//at.alicdn.com/t/font_1910062_4213q7gpkpy.svg#iconfont)format('svg')}</style><a href="https://space.bilibili.com/10929768/channel/detail?cid=12977" target=_blank rel="me noopener"><i class="iconfont icon-bilibili"></i></a><a href=https://github.com/niceRAM target=_blank rel="me noopener"><i class="iconfont icon-github"></i></a><a href=https://twitter.com/niceRAM95 target=_blank rel="me noopener"><i class="iconfont icon-twitter"></i></a><a href=mailto:niceniceram@gmail.com rel="me noopener"><i class="iconfont icon-mail01"></i></a><a href=https://t.me/niceRAM target=_blank rel="me noopener"><i class="iconfont icon-telegram"></i></a></div></div><div class=post-comment><div id=gitalk-container></div><link rel=stylesheet href=https://cdn.bootcss.com/gitalk/1.5.2/gitalk.css><script src=https://cdn.bootcss.com/gitalk/1.5.2/gitalk.min.js></script><script>const gitalk=new Gitalk({clientID:'e2ac76297f1e7ec232f9',clientSecret:'4385d32dd8c6ab5f97856bbe2e04a1e05a237276',repo:'blog-comments',owner:'niceRAM',admin:['niceRAM'],proxy:'https://cors-anywhere-niceblog.herokuapp.com/https://github.com/login/oauth/access_token',id:location.pathname,distractionFreeMode:!1});(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('gitalk-container').innerHTML='Gitalk comments not available by default when the website is previewed locally.';return}gitalk.render('gitalk-container')})()</script></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2018 - 2021</span>
<span class=rotating>ğŸŒ¸</span>
<span class=author itemprop=copyrightHolder><a href=https://niceram.xyz/>niceRAM</a> |</span>
<span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow">Hugo</a> & <a href=https://github.com/niceRAM/nicesima target=_blank rel="external nofollow">nicesima</a></span></div></footer><script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js crossorigin=anonymous></script><script defer src=/js/vendor_main.min.js></script><script src=https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script><script>pangu.spacingPage()</script></div></body></html>